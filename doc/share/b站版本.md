æ‰‹æŠŠæ‰‹æ•™ä½ åœ¨ AX8850 ä¸Šéƒ¨ç½²è‡ªå®šä¹‰ SD1.5 æ¨¡å‹ï¼

å„ä½å¥½ï¼Œä»Šå¤©ç»™å¤§å®¶å¸¦æ¥ä¸€ä¸ªè¶…ç¡¬æ ¸çš„æ•™ç¨‹ï¼š**å¦‚ä½•å°† Civitaiï¼ˆCç«™ï¼‰ä¸Šçš„ Stable Diffusion 1.5 æ¨¡å‹éƒ¨ç½²åˆ° AX8850 å¼€å‘æ¿ä¸Šï¼**

æƒ³è¦åœ¨ç«¯ä¾§è·‘è‡ªå·±å–œæ¬¢çš„äºŒæ¬¡å…ƒ/çœŸäººå¤§æ¨¡å‹å—ï¼Ÿè·Ÿç€è¿™ç¯‡æ•™ç¨‹èµ°ï¼Œä½ ä¹Ÿèƒ½æå®šï¼

> **âš ï¸ æ­¤æ•™ç¨‹æ‰€æœ‰é…å¥—ä»£ç è¯·è®¿é—® GitHubï¼š**
> `https://github.com/yuyun2000/sd15-to-ax8850-deploy`

---

## ç¬¬ä¸€æ­¥ï¼šæŒ‘é€‰ä½ çš„â€œæ¢¦ä¸­æƒ…æ¨¡â€

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å» C ç«™ï¼ˆ`civitai.com`ï¼‰é€‰ä¸€ä¸ªå¿ƒä»ªçš„æ¨¡å‹ã€‚
**ç­›é€‰æ¡ä»¶ï¼ˆæ•²é»‘æ¿ï¼‰ï¼š**
1.  **Base Model** å¿…é¡»æ˜¯ **SD 1.5**ã€‚
2.  **æ¨¡å‹ç±»å‹** å¿…é¡»æ˜¯å®Œæ•´çš„ **Checkpoint**ï¼ˆLoRA çš„æ•™ç¨‹ä»¥åå†å¡«å‘ï¼‰ã€‚
3.  **æ¨¡å‹å¤§å°** æœ€å¥½æ˜¯ **1.99G** å·¦å³ï¼ˆè¿™æ˜¯æœ€æ ‡å‡†çš„å‰ªæå¤§å°ï¼Œç¨å¾®å¤§ä¸€ç‚¹ç‚¹é€šå¸¸ä¹Ÿèƒ½è·‘ï¼Œå¯ä»¥è‡ªå·±è¯•è¯•ï¼‰ã€‚

æ¯”å¦‚è¿™æ¬¾ `xxmix9realistic`ï¼š
*(æ­¤å¤„è¯·æ’å…¥åŸæ•™ç¨‹ä¸­çš„ C ç«™æ¨¡å‹æˆªå›¾ img/1.png å’Œ img/2.png)*

ä¸‹è½½å¥½å¯¹åº”çš„ `.safetensors` æƒé‡æ–‡ä»¶ï¼Œæˆ‘ä»¬å¼€å§‹å¹²æ´»ï¼

---

## ç¬¬äºŒæ­¥ï¼šPC ç«¯ç¯å¢ƒå‡†å¤‡ä¸éªŒè¯

åœ¨å¼€å§‹è½¬æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ PC ä¸Šå…ˆè·‘é€šæµç¨‹ï¼Œç¡®ä¿æ¨¡å‹æ–‡ä»¶æ²¡é—®é¢˜ã€‚è¯·å…ˆåœ¨ PC ä¸Šé…ç½®å¥½ GitHub ä»“åº“ä¸­è¦æ±‚çš„ä¾èµ–ç¯å¢ƒã€‚

### 1. åŠ è½½ Safetensor è¿›è¡Œæ¨ç†æµ‹è¯•
è¿è¡Œ `safetensor_infer.py` çœ‹çœ‹æ¨¡å‹èƒ½ä¸èƒ½å‡ºå›¾ï¼š

```bash
python safetensor_infer.py \
    --input_path "./s/xxmix9realistic_v40.safetensors" \
    --output_path "./test_output" \
    --negative_prompt "easynegative,ng_deepnegative_v1_75t,(worst quality:2),(low quality:2),(normal quality:2),lowres,bad anatomy,bad hands,normal quality,((monochrome)),((grayscale)),((watermark))," \
    --prompt "1girl, upper body, (huge Laughing),sweety,sun glare, bokeh, depth of field, blurry background, light particles, strong wind,head tilt,simple background, red background,<lora:film:0.4>"
```

*(æ­¤å¤„è¯·æ’å…¥æ¨ç†ç»“æœå›¾ img/3.png)*
å¦‚æœèƒ½ç”Ÿæˆç±»ä¼¼ä¸Šé¢çš„å›¾ç‰‡ï¼Œè¯´æ˜æ¨¡å‹åŠ è½½æ­£å¸¸ã€‚

### 2. å¯¼å‡º ONNX æ¨¡å‹
æ¥ä¸‹æ¥æ˜¯å…³é”®çš„ä¸€æ­¥ï¼Œå¯¼å‡º ONNXï¼š

```bash
python export_onnx.py --input_path ./s/xxmix9realistic_v40.safetensors --output_path ./out_onnx --isize 480x320 --prompt "ä½ çš„æç¤ºè¯..."
```

**æ³¨æ„å‡ ä¸ªå‘ç‚¹ï¼š**
*   **åˆ†è¾¨ç‡è®¾ç½®ï¼š** `--isize` å¯ä»¥æ˜¯ `320x480` (ç«–å›¾)ã€`480x320` (æ¨ªå›¾) æˆ– `512x512`ã€‚**åƒä¸‡åˆ«è´ªå¤§**ï¼Œå†å¤§å®¹æ˜“æŠ¥é”™ï¼Œè€Œä¸”è¦å’Œåç»­ VAE çš„å°ºå¯¸å¯¹åº”ï¼ˆæœ‰8å€ç¼©æ”¾å…³ç³»ï¼‰ã€‚
*   **æ–‡æœ¬ç¼–ç å™¨ (Text Encoder)ï¼š** è„šæœ¬**ä¸ä¼š**å¯¼å‡ºæ–‡æœ¬ç¼–ç å™¨ã€‚åŸå› æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯ AX çš„å¯¼å‡º Demo ç¯å¢ƒæœ‰ç‚¹å°é—®é¢˜ï¼›äºŒæ˜¯ SD1.5 çš„æ–‡æœ¬ç¼–ç å™¨éƒ½æ˜¯ CLIPï¼ŒåŸºæœ¬é€šç”¨ï¼Œå’±ä»¬ç›´æ¥ç”¨ç°æˆçš„å°±è¡Œï¼ˆåé¢ä¼šç»™ä¸‹è½½é“¾æ¥ï¼‰ã€‚

### 3. (å¯é€‰) ONNX æ¨ç†éªŒè¯
è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ç¡®ä¿å¯¼å‡ºçš„ ONNX æ²¡æ¯›ç—…ï¼š
```bash
python dpm_infer.py
```
è®°å¾—ä¿®æ”¹ä»£ç é‡Œçš„è·¯å¾„å’Œæç¤ºè¯ã€‚
*(æ­¤å¤„è¯·æ’å…¥ ONNX æ¨ç†æˆªå›¾ img/4.png)*

---

## ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡é‡åŒ–æ ¡å‡†é›†

ä¸ºäº†è®©æ¨¡å‹åœ¨ NPU ä¸Šè·‘å¾—å¿«åˆå‡†ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡æ ¡å‡†æ•°æ®ã€‚è¿è¡Œï¼š

```bash
python prepare_data.py
```

è¿è¡Œåï¼Œç›®å½•ä¸‹ä¼šç”Ÿæˆ `calib_data_vae` å’Œ `calib_data_unet` æ–‡ä»¶å¤¹ã€‚
*æ³¨ï¼šä¸åŒçš„æ¨¡å‹å¯èƒ½éœ€è¦è°ƒæ•´ä»£ç ä¸­çš„æ ·æœ¬ï¼Œè¿½æ±‚ç²¾åº¦çš„æœ‹å‹å¯ä»¥è‡ªè¡Œä¿®æ”¹ã€‚*

---

## ç¬¬å››æ­¥ï¼šæ¨¡å‹è½¬æ¢ (AX8850 ä¸“ç”¨)

è¿™é‡Œéœ€è¦åˆ‡æ¢åˆ° **Pulsar** å·¥å…·é“¾ç¯å¢ƒï¼ˆç›®å‰ä½¿ç”¨ v4.2 ç‰ˆæœ¬ï¼‰ã€‚

### 1. è½¬æ¢ UNetï¼ˆé«˜èƒ½é¢„è­¦ï¼šéå¸¸æ…¢ï¼ï¼‰
```bash
pulsar2 build --input out_onnx/unet_sim_cut.onnx --config config_unet_u16.json --output_dir output_unet_ax --output_name unet.axmodel
```
â˜• **å»å–æ¯å’–å•¡å§**ï¼Œè¿™ä¸€æ­¥éå¸¸è€—æ—¶ã€‚åšä¸»å®æµ‹èŠ±äº† **68åˆ†é’Ÿ** æ‰è·‘å®Œã€‚

### 2. è½¬æ¢ VAE
```bash
pulsar2 build --input out_onnx/vae_decoder_sim.onnx --config config_vae_decoder_u16.json --output_dir output_vae_ax --output_name vae.axmodel
```
VAE è½¬æ¢ç›¸å¯¹å¿«ä¸€äº›ã€‚

---

## ç¬¬äº”æ­¥ï¼šä¸Šæ¿å®æµ‹ï¼

UNet å’Œ VAE è½¬æ¢å¥½ä¹‹åï¼Œé‚£ä¸ªé€šç”¨çš„ **Text Encoder** å»å“ªé‡Œé¢†ï¼Ÿ
ğŸ‘‰ `https://huggingface.co/yunyu1258/SD1.5-AX650-Dark_Sushi_Mix`

ä½ å¯ä»¥ä»ä¸Šé¢çš„ HuggingFace ä»“åº“ä¸‹è½½ Text Encoder çš„ axmodelã€‚åŒæ—¶ï¼Œä»“åº“é‡Œä¹Ÿæä¾›äº†åœ¨æ¿å­ä¸ŠåŠ è½½æ¨¡å‹è¿›è¡Œæ¨ç†çš„ Python è„šæœ¬ã€‚

æŠŠ `unet.axmodel`ã€`vae.axmodel` å’Œä¸‹è½½å¥½çš„ Text Encoder ä¼ åˆ°ä½ çš„ AX8850 æ¿å­ä¸Šï¼Œè¿è¡Œæ¨ç†è„šæœ¬ï¼Œè§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼

---
**è§‰å¾—æœ‰ç”¨çš„è¯ï¼Œæ±‚ä¸ªä¸‰è¿æ”¯æŒä¸€ä¸‹ï¼æœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµ~**

#AI #åµŒå…¥å¼å¼€å‘ #AX8850 #StableDiffusion #æ¨¡å‹éƒ¨ç½² #ç¡¬æ ¸æŠ€æœ¯